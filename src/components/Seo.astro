---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: "website" | "article";
  siteName?: string;
  schema?: unknown; // Any JSON-LD object (Organization, WebPage, etc.)
}

const {
  title,
  description,
  image,
  type = "website",
  siteName = "Bizibox",
  schema,
} = Astro.props;

// Build a canonical-like URL for social tags.
// If `site` is not configured yet, fall back to Astro.url.
const canonicalURL = Astro.site
  ? new URL(Astro.url.pathname, Astro.site).toString()
  : Astro.url.toString();

// Default social image (must be absolute URL)
const relativeImage = image ?? "/assets/og/bizibox-og-default.jpg";
const socialImage = relativeImage.startsWith("http")
  ? relativeImage
  : new URL(relativeImage, Astro.site).toString();

// OpenGraph image dimensions (1200x630 is recommended)
const ogImageWidth = "1200";
const ogImageHeight = "630";
const ogImageAlt = title;

// Map Astro current locale to a valid Open Graph locale code
const localeCode = Astro.currentLocale ?? "fr";
const ogLocaleMap: Record<string, string> = {
  fr: "fr_FR",
  en: "en_US",
  de: "de_DE",
};
const ogLocale = ogLocaleMap[localeCode] ?? localeCode;
---

<!-- Note: <title> and <meta name="description"> are handled by BaseLayout to avoid duplication -->
<!-- Open Graph uses the title and description props for social media tags -->

<!-- Open Graph -->
<meta property="og:type" content={type} />
<meta property="og:title" content={title} />
{description && <meta property="og:description" content={description} />}
<meta property="og:site_name" content={siteName} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:locale" content={ogLocale} />
{socialImage && <meta property="og:image" content={socialImage} />}
{socialImage && <meta property="og:image:width" content={ogImageWidth} />}
{socialImage && <meta property="og:image:height" content={ogImageHeight} />}
{socialImage && <meta property="og:image:type" content="image/jpeg" />}
{socialImage && <meta property="og:image:alt" content={ogImageAlt} />}

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
{description && <meta name="twitter:description" content={description} />}
{socialImage && <meta name="twitter:image" content={socialImage} />}

<!-- Optional JSON-LD structured data -->
{schema && (
  <script type="application/ld+json" is:inline>
    {JSON.stringify(schema)}
  </script>
)}
