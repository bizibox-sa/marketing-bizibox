---
import { getRelativeLocaleUrl } from "astro:i18n";
import LanguageSwitcher from "./ui/LanguageSwitcher.astro";
import Image from "astro/components/Image.astro";
import LogoAltFull from "../assets/branding/bizibox-logo-leaf-full.png";
import { homePageFr } from "../content/home.fr";
import { homePageEn } from "../content/home.en";
import { homePageDe } from "../content/home.de";

// Props interface for Header component
export interface Props {
  showNav?: boolean;
}

// Destructure props for Header component
const { showNav = true } = Astro.props;

// Get current locale from Astro.currentLocale with fallback
const locale = Astro.currentLocale || "fr";

// Compute home URL for the current locale using Astro i18n helper
const homeHref = getRelativeLocaleUrl(locale, "");

// Check if we're on the home page (path ends with locale or locale/)
const isHomePage = Astro.url.pathname === homeHref || Astro.url.pathname === `${homeHref}/`;

// Build navigation links - if not on home page, prefix with homeHref
const buildNavHref = (anchor: string) => (isHomePage ? anchor : `${homeHref}${anchor}`);

// Get content based on locale
const contentMap = {
  fr: homePageFr.ui.header,
  en: homePageEn.ui.header,
  de: homePageDe.ui.header,
};

// Get translations for the current locale with fallback to French
const t = contentMap[locale as keyof typeof contentMap] || contentMap.fr;
---

<header class="bg-transparent">
  <div class="mx-auto flex max-w-7xl items-center justify-between gap-x-4 px-4 py-4 sm:px-8">
    <!-- Brand / logo -->
    <a href={homeHref} class="inline-flex items-center gap-x-2">
      <!-- Simple logo placeholder -->
      <Image
        src={LogoAltFull}
        priority
        alt={t.logoAlt}
        class="h-11 w-auto object-contain select-none"
      />
      <span class="sr-only">{t.homeLabel}</span>
    </a>

    <div class="flex items-center gap-x-6">
      {
        showNav && (
          <nav aria-label={t.navLabel} class="hidden md:block">
            <ul class="flex items-center gap-x-4 text-sm font-medium text-gray-300">
              <li>
                <a
                  href={homeHref}
                  class="hover:text-white"
                  aria-current={isHomePage ? "page" : undefined}
                >
                  {t.home}
                </a>
              </li>
              <li>
                <a href={buildNavHref("#services")} class="hover:text-white">
                  {t.services}
                </a>
              </li>
              <li>
                <a href={buildNavHref("#about")} class="hover:text-white">
                  {t.about}
                </a>
              </li>
              <li>
                <a href={buildNavHref("#faq")} class="hover:text-white">
                  {t.faq}
                </a>
              </li>
            </ul>
          </nav>
        )
      }

      <!-- Language switcher -->
      <LanguageSwitcher />
    </div>
  </div>
</header>
